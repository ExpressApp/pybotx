# Миграция между версиями

В этом разделе описана политика версионирования pybotx и рекомендации по миграции между различными версиями библиотеки.

## Политика версионирования

pybotx следует принципам [Semantic Versioning](https://semver.org/) (SemVer) с некоторыми особенностями для версий 0.y.z:

1. **Мажорная версия (0)**: Указывает на то, что библиотека находится в активной разработке, и API может быть нестабильным.
2. **Минорная версия (y)**: Увеличивается при добавлении новой функциональности или при внесении изменений, которые могут нарушить обратную совместимость.
3. **Патч-версия (z)**: Увеличивается при исправлении ошибок без нарушения обратной совместимости.

> **Note**
> 
> Согласно SemVer, для версий 0.y.z API считается нестабильным, и изменения, нарушающие обратную совместимость, могут быть внесены при увеличении минорной версии. Это означает, что при обновлении с версии 0.x.z на 0.y.z (где y > x) могут потребоваться изменения в вашем коде.

## Миграция с 0.x на 0.y

### С 0.74.x на 0.75.x

- Добавлена поддержка Python 3.11
- Изменен интерфейс метода `Bot.create_chat()`: параметр `huids` теперь обязателен
- Удален устаревший параметр `recipients` в методе `Bot.answer_message()`
- Добавлена поддержка новых типов вложений

```python
# До 0.75.0
await bot.create_chat(
    bot_id=message.bot.id,
    name="Новый чат",
    chat_type=ChatTypes.GROUP_CHAT,
)

# После 0.75.0
await bot.create_chat(
    bot_id=message.bot.id,
    name="Новый чат",
    chat_type=ChatTypes.GROUP_CHAT,
    huids=[user1_huid, user2_huid],  # Обязательный параметр
)
```

### С 0.73.x на 0.74.x

- Изменен интерфейс метода `Bot.send_message()`: параметр `body` теперь обязателен
- Добавлена поддержка упоминаний в сообщениях
- Улучшена обработка ошибок при работе с API

```python
# До 0.74.0
await bot.send_message(
    bot_id=message.bot.id,
    chat_id=chat_id,
    body="",  # Пустое тело сообщения
    file=file,
)

# После 0.74.0
await bot.send_message(
    bot_id=message.bot.id,
    chat_id=chat_id,
    body="Файл:",  # Тело сообщения обязательно
    file=file,
)
```

## Рекомендации по апгрейду

Для безопасного обновления библиотеки рекомендуется следовать этим шагам:

1. **Фиксируйте версию в зависимостях**: Используйте точную версию библиотеки в `pyproject.toml` или `requirements.txt`:

   ```toml
   # pyproject.toml
   [tool.poetry.dependencies]
   pybotx = "0.75.1"  # Фиксированная версия
   ```

   ```
   # requirements.txt
   pybotx==0.75.1
   ```

2. **Читайте changelog**: Перед обновлением ознакомьтесь с изменениями в новой версии в [changelog](changelog.md).

3. **Тестируйте перед деплоем**: Всегда тестируйте вашего бота с новой версией библиотеки в тестовом окружении перед деплоем в продакшн.

4. **Используйте типизацию**: Аннотации типов помогут выявить несовместимости при обновлении библиотеки. Используйте mypy для статической проверки типов:

   ```bash
   mypy your_bot_module.py
   ```

5. **Обновляйте постепенно**: Если вы пропустили несколько версий, обновляйтесь постепенно, проверяя работоспособность на каждом шаге.

## Известные проблемы

- При использовании версии 0.74.x и выше с Python 3.8 могут возникать предупреждения о устаревших аннотациях типов. Эти предупреждения можно игнорировать, они будут исправлены в будущих версиях.
- В версии 0.75.0 есть известная проблема с обработкой больших файлов (>100MB). Рекомендуется использовать версию 0.75.1 или выше.

## Планы на будущее

- Стабилизация API и переход к версии 1.0.0
- Улучшение документации и примеров
- Расширение поддержки SmartApps
- Добавление новых типов вложений и интерактивных элементов

## См. также

- [Введение в pybotx](index.md)
- [Быстрый старт](quick_start.md)
- [Changelog](changelog.md)